---
title: "Main EDA"
output: html_document
date: "2023-09-16"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

# Hypothesis 2

We hypothesise that an optimal number of minimum nights exists for maximising Airbnb listing revenue. We aim to identify this optimal number by examining the relationship between minimum nights, price and booking frequency. Our goal is to provide valuable insights for potential Airbnb investors by uncovering the most lucrative strategy for setting minimum night requirements, considering additional factors like bed count for example.

Assumptions:
- Given the Airbnb data, there is no way to distinguish between rentals that have been blocked by the host or haven been rented, for simplicity we will assume that rentals that are not available, have been rented by users.

#Start of EDA

Before diving into our analysis, it's essential to set up our environment. We start by installing and loading the necessary packages for our Exploratory Data Analysis (EDA). Our analysis will be based on three datasets: listings_data, calendar data, and reviews_data. These datasets provide comprehensive information about the listings, their availability throughout the year and the reviews they've received.
```{r}
# Installing some packages needed for EDA
install.packages(c("dplyr", "ggplot2", "tidyr"))
library(dplyr)
library(ggplot2)
library(tidyr)

# Reading the Data
listings_data <- read.csv("listings_austin.csv")
calendar_data <- read.csv("calendar_austin.csv")
reviews_data <- read.csv("reviews_austin.csv")
```

Let's first take a look at the 'listings_data'. This dataset provides detailed information about each listing. By using the code below, we can get a quick overview of the first few rows, the structure of the dataset and some basic statistics for each column.
```{r}
# Quick overview of listings data
head(listings_data)
str(listings_data)
summary(listings_data)
```

Next, we explore the 'calendar_data'. This dataset gives us insights into the availability and pricing of listings throughout the year.
```{r}
# Quick overview of calendar data
head(calendar_data)
str(calendar_data)
summary(calendar_data)
```

Our third dataset, 'reviews_data', captures the details of the reviewers. 
```{r}
# Quick overview of reviews data
head(reviews_data)
str(reviews_data)
summary(reviews_data)
```

To wrap up our initial data exploration, let's list down all the columns present in the listings_data. This will give us a roadmap of the variables we have at our disposal for the analysis.
```{r}
# Columns for listing data
column_names <- names(listings_data)
print(column_names)
```

Before diving deeper into our analysis, it is crucial to ensure our data is clean and in the right format. 

```{r}
#Cleaning Data

#Remove dollar signs and commas, then convert to numeric (Prices in calendar and listings)
calendar_data$price <- as.numeric(gsub("[$,]", "", calendar_data$price))
calendar_data$adjusted_price <- as.numeric(gsub("[$,]", "", calendar_data$adjusted_price))
listings_data$price <- as.numeric(gsub("[$,]", "", listings_data$price))

#Changing Date type
calendar_data$date <- as.Date(calendar_data$date, format= "%Y-%m-%d")

#Convert Minimum Nights to integer
calendar_data$minimum_nights <- as.integer(calendar_data$minimum_nights)
listings_data$minimum_nights <- as.numeric(listings_data$minimum_nights)
listings_data$minimum_nights <- as.integer(listings_data$minimum_nights)

#Convert Room type to Character
listings_data$room_type <- as.character(listings_data$room_type)

#Convert Availability 365 to integer
listings_data$availability_365 <- as.numeric(listings_data$availability_365)
listings_data$availability_365 <- as.integer(listings_data$availability_365)

#Convert Number of Reviews to Integer
listings_data$number_of_reviews <- as.numeric(listings_data$number_of_reviews)
listings_data$number_of_reviews <- as.integer(listings_data$number_of_reviews)

#Convert Number of Reviews to Decimal (1 dp)
listings_data$review_scores_rating <- as.numeric(listings_data$review_scores_rating)
listings_data$review_scores_rating <- round(listings_data$review_scores_rating, 1)

#Convert Neighbourhood to character
listings_data$neighbourhood <- as.character(listings_data$neighbourhood)
```


Missing data can skew our analysis and lead to misleading conclusions, so it is crucial to ensure that the data columns we will be using are robust and complete. Everything looks fine (no NAs) except in review scores which makes sense as not all people are expected to leave a review.
```{r}
#Looking at number of NAs for certain columns in Listings (Df that I will be using)

# Price
na_price_listings <- sum(is.na(listings_data$price))
cat("Number of NA values in Price (listings):", na_price_listings, "\n")

# Minimum nights
na_min_nights_listings <- sum(is.na(listings_data$minimum_nights))
cat("Number of NA values in Minimum nights (listings):", na_min_nights_listings, "\n")

#Room Type
na_room_type_listings <- sum(is.na(listings_data$room_type))
cat("Number of NA values in Room Type (listings):", na_room_type_listings, "\n")

#Availability 365
na_availability_365_listings <- sum(is.na(listings_data$availability_365))
cat("Number of NA values in Availability 365 (listings):", na_availability_365_listings, "\n")

#Number of Reviews
na_number_of_reviews_listings <- sum(is.na(listings_data$number_of_reviews))
cat("Number of NA values in Number of Reviews (listings):", na_number_of_reviews_listings, "\n")

# Reviews score rating
na_reviews_score_rating_listings <- sum(is.na(listings_data$review_scores_rating))
cat("Number of NA values in Number of Reviews score rating (listings):", na_reviews_score_rating_listings, "\n")

#Neighbourhood
na_neighbourhood_listings <- sum(is.na(listings_data$neighbourhood))
cat("Number of NA values in Neighbourhood (listings):", na_neighbourhood_listings, "\n")
```

Before diving deep, we've taken a snapshot of our key data columns. This quick overview of prices, minimum nights, reviews and more, providing a foundational understanding, ensuring our later analysis is grounded in context.
```{r}
#Checking summary stats for relevant columns

#Summary Stats for Price
print(summary(listings_data$price))

#Summary Stats for Minimum Nights
print(summary(listings_data$minimum_nights))

#Summary Stats for Room Type
print(table(listings_data$room_type))

#Summary Stats for Availability 365
print(summary(listings_data$availability_365))

#Summary Stats for Number of Reviews
print(summary(listings_data$number_of_reviews))

#Summary Stats for Review Score Rating
print(summary(listings_data$review_scores_rating))

#Summary Stats for Neighbourhood
print(table(listings_data$neighbourhood))

```

We visualised the distribution of listing prices to identify potential outliers. While the broader view gave us the full range, a closer look revealed that most listings fall below 5000. To ensure a more accurate analysis, we've refined our dataset to exclude extreme values, focusing on listings priced between 10 and 800. Given that the average monthly rent is 1500 dollars in Austin, this seems like a good range to focus on.
```{r}
#Price
boxplot(listings_data$price, main="Boxplot of Prices", ylab="Price")
#to get a clearer picture, limiting it to 5000
boxplot(listings_data$price, ylim=c(0,5000), main="Boxplot of Prices", ylab="Price")
#Exclude anything over 2000 (based on plot) and anything under (10 dollars) which seems to be too low
listings_data <- listings_data[listings_data$price>=10 & listings_data$price <= 800, ]
cat("Number of rows after filtering:", nrow(listings_data), "\n")
```

We examined the distribution of minimum nights required for listings. The majority of listings require stays well under 500 nights. To focus on more typical listings and avoid potential outliers, we've limited our dataset to those requiring 30 nights or fewer.This makes sense as Airbnb originally termed "Air Bed & Breakfast" underscores its focus on short term stays. Austin's regulations, which define short-term rentals as those less than 30 consecutive days aligns with this concept.
```{r}
#Minimum Nights
boxplot(listings_data$minimum_nights, main="Boxplot of Minimum Nights", ylab="Minimum Nights")
#to get a clearer picture, limiting it to 100
boxplot(listings_data$minimum_nights, ylim=c(0,100), main="Boxplot of Minimum Nights", ylab="Minimum Nights")
#Exclude anything over 30 days based on plot
listings_data <- listings_data[listings_data$minimum_nights <=30, ]
cat("Number of rows after filtering:", nrow(listings_data), "\n")
```

We analysed the distribution of the number of reviews for listings. To ensure a more representative dataset and eliminate extreme outliers, we've restricted our analysis to listings with 600 reviews or fewer.
```{r}
#Number of Reviews
boxplot(listings_data$number_of_reviews, main="Boxplot of Number of Reviews ", ylab="Number of Reviews")
#Exclude anything above 600 based on plot
listings_data <- listings_data[listings_data$number_of_reviews <=600, ]
cat("Number of rows after filtering:", nrow(listings_data), "\n")
```

We visually inspected the distribution of 'Availability 365' and 'Review Score Ratings' using boxplots. This helps us understand the spread of these variables.
```{r}
# Boxplots to visually look at distribution

#Availability 365
boxplot(listings_data$availability_365, main="Boxplot of Availability 365", ylab="Availability 365")

#Review Score Rating
boxplot(listings_data$review_scores_rating, main="Boxplot of Review Score Rating", ylab="Review Score Rating")
```

.To better understand the dynamics of our listings, we've derived three new metrics:
1. Booking Frequency: Calculated as the difference between a full year (365 days) and the number of days a listing is available.
2. Booking Frequency Percentage: Represents the proportion of the year a listing is booked, expressed as a percentage (to one deicmal place).
3. Estimated Revenue: An approximation of the annual revenue for a listing, computed by multiplying its price with its booking frequency.

These metrics will be crucial in our later analysis, offering insights into the profitability and popularity of listings.
```{r}
#Creating booking frequency
listings_data$booking_frequency <- (365 - listings_data$availability_365)
#Creating booking frequency (%) to 1 dp
listings_data$booking_frequency_percentage <- round(((365 - listings_data$availability_365)/365)*100,1)
#Creating Revenue
listings_data$estimated_revenue <- listings_data$price * listings_data$booking_frequency
```

_Start of Main EDA


As you can see below, the distribution of prices for listings is left-skewed, meaning majority of listings are priced on the lower end with fewer listings having a higher price. Let's see the distribution of prices by minimum nights.
```{r}
#Distribution of Prices
ggplot(listings_data, aes(x=price)) + 
  geom_histogram(binwidth = 10, fill= "blue", color="black", alpha= 0.7) + 
  labs(title= "Distribution of Prices for Lisitings in Austin", x="Price", y= "Number of Listings") +
  theme_minimal()

#Boxplot for Prices
ggplot(listings_data, aes(y=price)) +
  geom_boxplot(fill= "blue", color= "black", alpha=0.7) +
  labs(title = "Boxplot of Prices for Listings in Asutin", y="Price") +
  theme_minimal()
  
```

The histogram below visualises the distribution of listing prices segmented by the minimum number of nights required for booking. Each panel represents a distinct minimum night requirement and the y-axis indicates the number of listings within each price bin.

Across most minimum night categories, the price distribution is predominantly left-skewed.

This indicates that a majority of listings, regardless of their minimum night requirement, are priced on the lower end of the spectrum.
Such a trend suggests that more affordable listings tend to be more common on the platform, irrespective of the duration of stay they cater to.

```{r}
# Distribution of of prices by minimum nights
ggplot(listings_data, aes(x=price, fill= as.factor(minimum_nights)))+
  geom_histogram(binwidth = 10, position= "identity", alpha=0.5) +
  labs(title= "Distribution of Prices by Minimum Nights", x= "Price ($)", y= "Number of Listings") +
  theme_minimal() +
  facet_wrap(~minimum_nights, scales= "free_y") 
  
```

The boxplot provides insights into the distribution of listing prices based on the minimum number of nights required for booking.

. Median price for a single night is around 120.
. Prices vary widely for 1-4 night stays, with many outliers.
. 5-6 night stays show a reduced price range, with a slight rise at 7 nights.
. 9-night stays resemble 4-night stays in terms of price distribution.
. Beyond 10 nights, for the most part, prices stabilize with most listings priced between 100 and 200.
```{r}
# Another plot of Dstribution of Prices by Minimum Nights
ggplot(listings_data, aes(x= as.factor(minimum_nights), y=price, fill= as.factor(minimum_nights))) +
  geom_boxplot() +
  labs(title= "Distribution of Prices by Minimum Nights", x="Minimum Nights", y= "Price ($)")+
  theme_minimal() +
  theme(legend.position = "none")
```
The bar chart visualises the distribution of Airbnb listings based on the minimum number of nights required for booking.

.A significant majority of listings prefer short stays, with 1 and 2-night minmum stays each having just over 4000 listings.
.3-night minimumstays are also popular, nearing 1500 listings.
.There's a sharp decline in listings from 4 to 7 nights.
.Beyond 7 nights, listings are sparse, with a slight resurgence at 30 nights.

This trend indicates that most hosts in Austin prefer short-term bookings, with a few accommodating longer stays.
```{r}
# Number of Listings by Minimum Nights Plot
ggplot(listings_data, aes(x=as.factor(minimum_nights))) +
  geom_bar(fill= "steelblue") +
  labs(title = "Number of Listings by Minimum Nights", x="Minimum Nights", y= "Number of Listings") +
  theme_minimal()

```
The following bar chart represents the weighted average price of Airbnb listings based on the minimum number of nights required for booking.

.The weighted average price increases from nights 1 to 4, peaking at approximately 275 for 4-night stays.
.A decline is observed from nights 5 to 8, with the lowest average around 140 for 8-night stays.
.There's a noticeable spike at 9 nights, likely influenced by a limited number of listings.
.Prices for 10 to 21 nights fluctuate within the 100-200 range, with exceptions at 17 and 18 nights.
.Another spike is seen at 24 nights, potentially due to fewer listings.
.The trend from 25 to 30 nights shows a gradual decrease in average prices.

This analysis suggests that while short stays (1-4 nights) tend to have higher prices, there are specific minumum night where prices spike, possibly influenced by limited listings.
```{r}
# Calculate weighted average
weighted_avg_price <- listings_data %>%
  group_by(minimum_nights) %>%
  summarise(
    total_price= sum(price),
    count= n(),
    weighted_avg =total_price/ count
  )
#Plot
ggplot(weighted_avg_price, aes(x= as.factor(minimum_nights), y= weighted_avg, fill= as.factor(minimum_nights)))+
  geom_bar(stat= "identity") +
  labs(title= "Weighted Average Price by Minimum Nights", x= "Minimum Nights", y= "Weighted Average Price ($)") +
  theme_minimal() +
  theme(legend.position = "none")
```
The scatter plot below visualises the relationship between the price of Airbnb listings and the minimum number of nights required for booking.

.Nights 1 to 3 display a dense concentration of points, forming almost straight lines up to 800.
.Nights 4 and 5 have a similar pattern up to around 400, with some scattered points beyond this range.
.Night 6 shows a denser concentration below 200, with fewer scattered points above this mark.
.Night 7 has a consistent distribution up to 300, with some outliers reaching up to 600.
.For nights 8 to 29, most listings are priced below 300, with occasional outliers.
.Night 30 presents a unique pattern with a dense line up to 400, followed by scattered points, some reaching above 500.

The scatter plot indicates that shorter stays (1-3 nights) tend to have a wider range of prices, while longer stays (8-29 nights) generally have listings priced below 300. The 30-night stays show a mix of both patterns.
```{r}
#Scatter Plot of Price vs Minimum Nights
ggplot(listings_data, aes(x=minimum_nights, y=price)) +
  geom_point(alpha= 0.5) +
  labs(title= "Scatter Plot of Price vs Minimum Nights", x= "Minimum Nights", y= "Price ($)")+
  theme_minimal()
```
The heatmap below provides a visual representation of the distribution of Airbnb listing prices based on the minimum number of nights required for booking.

For Category 1 (1 Night), listings are mainly priced between 80-100, with a notable presence in the 100-150 range. Category 2 (2 Nights) predominantly sees listings in the 100-150 bracket. Category 3 (3 Nights) has a more uniform distribution, especially between 100-200. Category 4 (4-7 Nights) mainly features listings priced at 80-100, while Category 5 (8-30 Nights) mainly features listings priced at 80-120.

The heatmap suggests that shorter stays (1-2 nights) have a wider variety of prices, with a significant number of listings priced below 150. 
```{r}
listings_data$min_nights_bin <- cut(listings_data$minimum_nights,
                                    breaks= c(0,1,2,3,7,30),
                                    labels = c("1", "2", "3", "4-7", "8-30"),
                                    include.lowest = TRUE)

#Heatmap
ggplot(listings_data, aes(x= as.numeric(min_nights_bin), y= price)) +
  geom_bin2d(bins= 30, aes(fill = ..count..), color= "white")+
  scale_fill_gradient(low= "white", high= "blue") +
  labs(title = "Heatmap of Number of Minimmum Nights Category by Price", x= "Minimum Nights Category", y= "Price ($)") +
  theme_minimal() +
  scale_x_continuous(breaks= c(1,2,3,7,30), labels = c("1","2", "3", "4-7", "8-30"))


```
Below are the key statistics for Airbnb listing prices.

The average listing price is approximately 192.43 with a median of 145.The standard deviation of 150.91 suggests a wide variability in the listing prices, which is something that needs to be looked at more closely.

The correlation coefficient of around -0.15 indicates a weak negative relationship between minimum number of nights and listing price.
```{r}
price_stats <- listings_data %>%
  summarise(
    average_price= mean(price),
    median_price= median(price),
    min_price= min(price),
    max_price= max(price),
    sd_price= sd(price)
  )
print(price_stats)

#Correlation
correlation <- cor(listings_data$minimum_nights, listings_data$price, method= "pearson", use= "complete.obs")
print(correlation)
```
Given the high standard deviation in listing prices, we look at possible option to segment the prices to understand the distribution better. One common method to segment the price is by using qauntiles as shown in the output below

.The interquartile range (IQ), represented by the box's height, spans from 91 to 242.
.The whiskers of the boxplot extend up to approximately 475, indicating the range within which most of the data points lie.

To sum up, while the majority of listings are priced within a relatively moderate range, there's a noticeable segment of premium-priced listings that skew the overall distribution.
```{r}
#Let's look at some possible segmentation by price due to high sd in prices
#Calculate quantiles for price
price_quantiles <- quantile(listings_data$price, probs= c(0.25,0.5,0.75))

#Print the quantiles
print(price_quantiles)

#Plot a boxplot to visualise the distribution of Prices again
ggplot(listings_data, aes(y= price)) +
  geom_boxplot() +
  labs(title= "Boxplot of Listing Prices", y= "Prices") +
  theme_minimal()
```
The histograms depict the booking frequency both in terms of days booked and as a percentage of the year.

.High Frequency: Nearly 4,000 listings are booked for 95%-100% of the year, indicating high demand.
.Low Frequency: About 2,000 listings have a booking rate of 0%-5%, suggesting limited popularity or availability.
.Mid-Range: Listings with a 50%-75% booking rate show varied numbers, with a noticeable dip at 45% and a peak near 75%.

In summary, listings are either highly popular or less sought after, with few in the middle range.
```{r}
#Distribution of booking frequency
ggplot(listings_data, aes(x= booking_frequency)) +
  geom_histogram(binwidth = 10, fill = "skyblue", color ="black") +
  labs(title= "Distribution of Booking Frequency (Days Booked in a Year)", x= "Number of Days Booked", y= "Number of Listings") +
  theme_minimal()

#Distribution of booking frequency %
ggplot(listings_data, aes(x= booking_frequency_percentage)) +
  geom_histogram(binwidth = 10, fill = "skyblue", color ="black") +
  labs(title= "Distribution of Booking Frequency (%)", x= "Percentage of Days Booked", y= "Number of Listings") +
  theme_minimal()
```
The plot below shows the following:

.Short Stays (1-4 nights): Booking frequency rises from just above 50% to nearly 75%.
.Mid-range Stays (5-8 nights): A slight dip at 5 nights, but generally stable.
.Outliers: A spike at 9 nights near 100%, likely due to fewer listings. No data for 11, 19, 22, and
23 nights.
.Longer Stays (10+ nights): Frequencies vary between 50% and 88%, with dips at 15 and 27 nights to below 25%.

```{r}
#Grouping by Minimum Nights and calculating average booking frequency
booking_by_min_nights <- listings_data %>%
  group_by(minimum_nights) %>%
  summarise(
    avg_booking_frequency = mean(booking_frequency),
    avg_booking_frequency_percentage = mean(booking_frequency_percentage)
  )


#Plotting
ggplot(booking_by_min_nights, aes(x= minimum_nights, y= avg_booking_frequency_percentage)) +
  geom_bar(stat= "identity", fill = "lightgreen") +
  labs(title= "Average Booking Frequency by Minimum Nights", x= "Minimum Nights", y= "Average Booking Frequency (%)")+
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust= 1))
```
The central tendency of booking frequency is around 70%. The data spans from near 25% to a maximum of 100% booking frequency.

The median booking frequency for listings is around 70% of the year. However, a significant number of listings have a booking frequency below the median, indicating variability in how often listings are booked. Some listings are booked almost all year round, while others are available more frequently.
```{r}
# Boxplot of Booking frequency %
ggplot(listings_data, aes(y= booking_frequency_percentage)) +
  geom_boxplot(fill= "salmon") +
  labs(title= "Boxplot of Booking Frequency (%)", y= "Booking Frequency (%)") +
  theme_minimal()
```
There's a very weak negative correlation between the minimum number of nights a listing can be booked for and its booking frequency percentage. This suggests that as the minimum number of nights increases, the booking frequency percentage slightly decreases. However, the correlation is so weak that it is probably not practically significant.
```{r}
correlation_bf_r <- cor(listings_data$minimum_nights, listings_data$booking_frequency_percentage, method= "pearson", use= "complete.obs")
print(correlation_bf_r)
```

.The plot shows a weak negative relationship between booking frequency and price. 
.Most listings are priced below 400.
.Listings priced above 400 are concentrated at low booking frequencies (0-12.5%) and at 100%.
```{r}
#Scatter Plot of Price vs Booking Frequency Percentage
ggplot(listings_data, aes(x= booking_frequency_percentage, y=price)) +
  geom_point(alpha=0.5) +
  geom_smooth(method = "lm", color= "red") +
  labs(title= "Scatter Plot of Price vs Booking Frequency Percentage", x= "Booking Frequency (%)", y= "Price ($)") +
  theme_minimal()
```
Most listings have 1 bed (around 5000), followed by 2 beds (around 3500) and 3 beds (around 2200).
Listings drop sharply after 4 beds (around 1000) and continue to decrease. Accommodations with many beds are rare.
```{r}
#Histogram of Number of Beds
ggplot(listings_data, aes(x= beds))+
  geom_histogram(binwidth = 1, fill= "skyblue", color= "black") +
  labs(title= "Distribution of Number of Beds", x= "Number of Beds", y= "Number of Listings") +
  theme_minimal()
```
Prices generally rise with the number of beds. A drop is seen at 15 beds and an outlier appear at 15 beds with an average price of close to 800 probably due to low number of listings in this category. Sparse data is observed after except at 23 and 25 both averaging close to 200.
```{r}
#Grouping by Number of Beds and calculating average price
avg_price_by_beds <- listings_data %>%
  group_by(beds) %>%
  summarise(avg_price= mean(price))

#Bar Plot of average price by number of beds
ggplot(avg_price_by_beds, aes(x= beds, y= avg_price)) +
  geom_bar(stat= "identity", fill= "lightgreen") +
  labs(title= "Average Price by Number of Beds", x= "Number of Beds", y="Average Price ($)") +
  theme_minimal()
```
To simplify our analysis and improve interpretability when it comes to the analysis, we dropped listings with more than 10  beds. This is because we observed a significant drop in the number of listing for properties with ore than 10 beds. Including these could introduce noise and skew our analysis due to the spare data in these categories.

We have also grouped the number of beds into the following categories: 1,2,3,4,5 and 6+. This approach captures the nuances in the lower catrgories while also accounting for the higher categores without letting them skew the analysis.
```{r}
#Dropping Listings with less than 10 beds
listings_data <- listings_data %>% filter(beds <= 10)

#Grouping the number of beds
listings_data$beds_grouped <- case_when(
  listings_data$beds == 1 ~ "1",
  listings_data$beds == 2 ~ "2",
  listings_data$beds == 3 ~ "3",
  listings_data$beds == 4 ~ "4",
  listings_data$beds == 5 ~ "5",
  listings_data$beds >= 6 ~ "6+"
)


```

Looking at the number of NAs within this subset and it turns out it is zero so we can proceed.
```{r}
#Subset of beds less than or equal to 10
filtered_bed_data <- listings_data %>% filter(beds <= 10)

# Checking number of Nas in this subset
na_count_filtered_bed <- sum(is.na(filtered_bed_data$beds))
print(na_count_filtered_bed)

```

1 bed listings have the highest booking frequency, slightly above 60%.2 to 4 beds listings see a gradual decrease in booking frequency, with each category being slightly lower than the previous. There is a slight uprise in booking frequency in 5 beds higher than 4 but the downward trend continues in 6+ beds listings having the lowest frequency, close to 40%.

This suggests smaller accommodations are more frequently booked, while larger ones, especially 6+ beds, have niche demand.
```{r}
#Grouping by Number of Beds and calculating average booking frequency
avg_booking_by_beds <- listings_data %>%
  group_by(beds_grouped) %>%
  summarise(avg_booking_frequency = mean(booking_frequency_percentage))

# Bar Plot of Average Booking Frequency by Number of Beds
ggplot(avg_booking_by_beds, aes(x= beds_grouped, y= avg_booking_frequency))+
  geom_bar(stat= "identity", fill= "lightblue")+
  labs(title= "Average Booking Frequency (%) by Number of Beds", x= "Number of Beds", y= "Average Booking Frequency (%)") +
  theme_minimal()
```

The boxplot showcases a clear upward trend in median prices as the number of beds increases, starting from close to 100 for single-bed listings to nearly 400 for those with 6+ beds. Notably, single-bed listings exhibit the most outliers in price, which diminishes progressively as we move to higher bed categories. This pattern underscores the potential value in segmenting listings by both price and bed count.
```{r}
#Boxplot to look beds (by price)
ggplot(listings_data, aes(x=factor(beds_grouped), y= price)) +
  geom_boxplot() +
  labs(title= "Boxplot of Price by Number of Beds", x= "Category of Beds", y= "Price ($)") +
  theme_minimal()
```

### AK: Needs new annotation based on new cleaning and if you want to add mean line and median line, feel free to do so
```{r}
library(ggplot2)

# Plotting the histogram with enhanced colors and annotations
ggplot(listings_data, aes(x = estimated_revenue)) +
  geom_histogram(aes(y = ..density..), binwidth = 50, fill = "#66c2a5", color = "#238b45", alpha = 0.7) +
  geom_density(color = "#d95f02") +
  labs(title = "Distribution of Estimated Revenues (Capped at 130K)",
       x = "Estimated Revenue in Thousands",
       y = "Density") +
  theme_minimal() +
  scale_x_continuous(labels = scales::dollar_format(scale = 1e-3, prefix = "$"), limits = c(0, 130000))  # Setting the upper x-axis limit to $130,000 and formatting labels as dollars
```



The histograms reveal a predominantly left-skewed distribution for estimated revenue across bed categories. The median revenue exhibits a rising trend, peaking for listings with 5 beds. Interestingly, the 6+ bed category sees a dip, bringing its median revenue closer to that of the 3-bed listings. The first three bed categories, in particular, have a notable presence of outliers, suggesting a wide range of revenue values within these groups. As we consider segmenting listings, these patterns emphasize the importance of considering both bed count and revenue.
```{r}
#To avoid scientific notations in Estimated Revenue
options(scipen = 999)
# Histogram to view distribution of revenue by beds categories
ggplot(listings_data, aes(x= estimated_revenue, fill= factor(beds_grouped))) + 
  geom_histogram(binwidth=100, position="identity", alpha=0.6) + 
  labs(title= "Distribution of Revenue by Number of Beds", x= "Estimated Revenue ($)", y="Count") +
  theme_minimal () + 
  facet_wrap(~beds_grouped, scales= "free_y")

#Boxplot to look beds (by revenue)
ggplot(listings_data, aes(x=factor(beds_grouped), y= estimated_revenue)) +
  geom_boxplot() +
  labs(title= "Boxplot of Price by Number of Beds", x= "Category of Beds", y= "Estimated Revenue ($)") +
  theme_minimal()
```

### AK: Double check analysis holds
The correlation analysis highlights the significant impact of minimum nights stayed on estimated revenues. A moderate negative correlation coefficient of -0.12 indicates that increasing the minimum nights requirement is associated with lower estimated revenues. This relationship is statistically significant, emphasizing the importance of setting minimum stay requirements thoughtfully. The provided code includes a scatter plot with a blue linear regression line to visualize this relationship and presents the correlation coefficient and p-value from the Pearson’s correlation test.

```{r}
# Create a formatted version of estimated revenue as dollars
listings_data$dollar_revenue <- dollar(listings_data$estimated_revenue)

# Calculate the correlation coefficient
correlation_value <- cor(listings_data$minimum_nights, listings_data$estimated_revenue)

# Create the scatter plot
ggplot(listings_data, aes(x=minimum_nights, y=estimated_revenue)) +
  geom_point(alpha=0.5) +  # Adjust transparency
  geom_smooth(method="lm", color="blue", se=FALSE, formula = y ~ x) +  # Add regression line
  annotate("text", x = max(listings_data$minimum_nights) - 5, 
           y = max(listings_data$estimated_revenue), 
           label = paste("Correlation =", round(correlation_value, 2)), 
           color = "blue", size = 4, hjust = 1, vjust = 1) +  # Add correlation value
  theme_minimal() +
  labs(title="Scatter plot of Minimum Nights vs. Estimated Revenue",
       x="Minimum Nights",
       y="Estimated Revenue ($)") +
  scale_y_continuous(labels = dollar_format())  # Format y-axis as dollars
```
### AK: Need to comment on this and add the map
```{r}
# Calculate the average estimated_revenue for each zip code
avg_revenue_by_zip <- listings_data %>%
  group_by(neighbourhood_cleansed) %>%
  summarize(avg_revenue = mean(estimated_revenue, na.rm = TRUE))

# Create the scatter plot
ggplot(avg_revenue_by_zip, aes(x = neighbourhood_cleansed, y = avg_revenue)) +
  geom_point(color = "#1f78b4", size = 3) +
  labs(
    title = "Average Estimated Revenue by Zip Code",
    x = "Zip Code",
    y = "Average Estimated Revenue"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for better readability
```

```{r}
#ADD. MAP HERE!
```


######END of EDA #######

###Start of Analysis####

The results below indicate that listings with a shorter minimum nights requirement (1-7 nights) tend to generate higher revenue on average compared to those with a longer minimum nights requirement (8+ nights). This could be attributed to several factors, including higher demand for short-term stays, flexibility for travelers, and potentially higher nightly rates for short-term listings.

For hosts aiming to maximise their revenue, it might be beneficial to consider setting their minimum nights requirement within the 1-7 nights range. However, other factors such as location, amenities and guest preferences should also be taken into account when making this decision.

```{r}
# Categorise the Minimum Nights 
listings_data$min_nights_category <- ifelse(listings_data$minimum_nights <= 7, "1-7 Nights", "8+ Nights")

# Group by Minimum Nights Category
grouped_data <- listings_data %>%
  group_by(min_nights_category) %>%
  summarise(total_revenue= sum(estimated_revenue), total_listings= n())

# Computing weighted average revenue
grouped_data$weighted_avg_revenue <- grouped_data$total_revenue/ grouped_data$total_listings

#Plot
ggplot(grouped_data, aes(x= min_nights_category, y= weighted_avg_revenue, fill= min_nights_category)) +
  geom_bar(stat="identity") +
  labs(title= "Weighted Average Revenue by Minimum Nights Category", x="Minimum Nights Category", y= "Weighted Average Revenue ($)") +
  theme_minimal() +
  theme(legend.position = "none")
```

We segmented the listings in our dataframe based on the number of beds, categorizing them into groups such as "1", "2", "3", "4", "5", and "6+". For each bed category, we further segmented the listings into pricing quartiles, classifying them as "Budget", "Mid-Range", "Premium", and "Luxury". Based on this segmentation, we make the assumption that then "Luxury" listings, irrespective of bed count, are situated in prime locations, offer superior amenities, and have consistently positive reviews. The price point is indicative of the premium offerings these listings provide. Conversely, the "Budget", "Mid-Range", and "'Premium" listings offer amenities and experiences that align with their respective price points. While this assumption provides a foundational guideline for our analysis, individual listings may have characteristics that deviate from these general categorizations.

```{r}
#Function to categorize listings based on quartiles within each bed category 
categorize_price <- function(df) {
  quantiles <- quantile(df$price, probs= c(0.25, 0.5, 0.75))
  df$price_category <- case_when(
    df$price <= quantiles[1] ~ "Budget",
    df$price > quantiles[1] & df$price <= quantiles[2] ~ "Mid-Range",
    df$price > quantiles[2] & df$price <= quantiles[3] ~ "Premium",
    df$price > quantiles[3] ~ "Luxury"
  )
  return(df)
}

#Apply function to each bed category
listings_data <- listings_data %>%
  group_by(beds_grouped) %>%
  group_modify(~ categorize_price(.))

head(listings_data)

```

The consistency in the results across all pricing categories reinforces our earlier observation that listings with a shorter minimum nights requirement tend to generate higher revenue.

This trend holds true even when accounting for different pricing segments, suggesting that the minimum nights requirement plays a significant role in influencing revenue, regardless of the listing's price point.

Hosts across all pricing categories might consider setting their minimum nights requirement within the 1-7 nights range to potentially maximise their revenue. We will dive deeper into the data.

```{r}
# Organising Pricing Category
listings_data$price_category <- factor(listings_data$price_category, levels = c("Budget", "Mid-Range", "Premium", "Luxury"))
# Categorize the Minimum Nights 
listings_data$min_nights_category <- ifelse(listings_data$minimum_nights <= 7, "1-7 Nights", "8+ Nights")

# Group by Minimum Nights Category
grouped_data <- listings_data %>%
  group_by(min_nights_category, price_category) %>%
  summarise(total_revenue= sum(estimated_revenue), total_listings= n()) %>%
  mutate(weighted_avg_revenue = total_revenue/total_listings)

# Computing weighted average revenue
grouped_data$weighted_avg_revenue <- grouped_data$total_revenue/ grouped_data$total_listings

#Plot
ggplot(grouped_data, aes(x= min_nights_category, y= weighted_avg_revenue, fill= price_category)) +
  geom_bar(stat="identity", position = "dodge") +
  labs(title= "Weighted Average Revenue by Minimum Nights and Price Category", x="Minimum Nights Category", y= "Weighted Average Revenue ($)") +
  theme_minimal() +
  scale_fill_brewer(palette= "Set2")
  theme(axis.text.x = element_text(angle= 45, hjust= 1))
```
The higher standard deviation in the Luxury category than the other categories indicates that our analysis for this segment might be less robust compared to the other segments.
```{r}
#Distribution of Price by Number of Beds and Pricing Categories
price_stats_by_beds_and_category <- listings_data %>%
  group_by(beds_grouped, price_category) %>%
  summarise(
    mean_price = mean(price),
    median_price = median(price),
    sd_price= sd(price),
    count= n()
  )

print(price_stats_by_beds_and_category)
```

Given the skewed distribution of our data, with a higher proportion of Premium and Luxury listings in the 1-7 nights category, it's essential to approach our analysis with caution. We cannot solely rely on the aggregated insights from the 1-7 nights category. Instead, it's crucial to delve deeper and examine the revenue metrics for each individual minimum night within this category to draw more accurate conclusions.

```{r}
# The number of listings in each category combination
listings_count <- listings_data %>%
  group_by(min_nights_category, price_category) %>%
  summarise(count= n())
print(listings_count)

# The proportions of listings in each category combination
listings_proportions <- listings_data %>%
  group_by(min_nights_category) %>%
  count(price_category) %>%
  mutate(proportion= (n/sum(n)*100))

print(listings_proportions)
```

```{r}
booking_frequency_summary <- listings_data %>%
  group_by(price_category) %>%
  summarise(
    mean_booking_frequency = mean(booking_frequency_percentage),
    median_booking_frequency= median(booking_frequency_percentage),
    sd_booking_frequency = sd(booking_frequency_percentage),
    count= n()
  )

print(booking_frequency_summary)

#Plotting the booking frequency for each pricing category
ggplot(listings_data, aes(x= price_category, y= booking_frequency_percentage, fill= price_category)) +
  geom_boxplot() +
  labs(title= "Distribution of Booking Frequency by Pricing Category", x= "Pricing Category", y= "Booking Frequency %") +
  theme_minimal() +
  theme(legend.position = "none")
```

The standard deviation in booking frequency is high most likely due to the forward looking nature of the data.

```{r}
booking_frequency_by_min_nights <- listings_data %>%
  group_by(min_nights_category,price_category) %>%
  summarise(
    mean_booking_frequency = mean(booking_frequency_percentage),
    median_booking_frequency= median(booking_frequency_percentage),
    sd_booking_frequency = sd(booking_frequency_percentage),
    count= n()
  )

print(booking_frequency_by_min_nights)

#Plotting the booking frequency for each pricing category
ggplot(listings_data, aes(x= min_nights_category, y= booking_frequency_percentage, fill= price_category)) +
  geom_boxplot() +
  labs(title= "Distribution of Booking Frequency by Pricing Category", x= "Pricing Category", y= "Booking Frequency %", fill= "Price Category") +
  theme_minimal() +
  theme(axis.text.x= element_text(angle= 45, hjust = 1))
```

```{r}
#Filter the data for 1-7 Minimum Nights
filered_min_night_data <- listings_data %>% filter(minimum_nights <= 30)

#Group by Price Category and Minimum Nights and calculate weighted average
optimal_nights_data <- filered_min_night_data %>%
  group_by(price_category, minimum_nights) %>%
  summarise(weighted_avg_revenue= sum(price* booking_frequency)/ n())

#Plotting Weighted Average Revenue for each Minimum Night by Price Category
ggplot(optimal_nights_data, aes(x= as.factor(minimum_nights), y= weighted_avg_revenue, color= price_category, group= price_category)) +
  geom_line(size=1) +
  geom_point(size=3) +
  labs(title= "Weighted Average Revenue by Minimum Nights and Price Category", x= "Minimum Nights", y= "Weighted Average Revenue ($)", color= "Price Category")+
  theme_minimal() +
  theme(axis.text.x = element_text(angle= 45, hjust = 1))
```

However, it is inaccurate to say that the optimal minimum night for luxury is 9. Because there is only one luxury listing at 54,000. 

```{r}
#Filter for Luxury Listings with minimum nights of 9
luxury_min_night_9 <- filtered_min_night_data %>%
  filter(price_category == "Luxury", minimum_nights == 9) %>%
  summarise(
    number_of_listings= n(),
    weighted_avg_revenue = sum(price* booking_frequency)/ n()
  )
print(luxury_min_night_9)
```
Given that the majority of our listings are concentrated within the 1-7 minimum nights range, we believe that focusing our analysis on this segment will provide the most representative and actionable insights. Analyzing this segment allows us to make data-driven decisions based on where most of our business activity occurs. While we acknowledge the presence of listings outside this range, their relatively smaller proportion might introduce variability that could skew our overall understanding. Therefore, our primary analysis will center on the 1-7 nights range, ensuring that our insights and recommendations are grounded in the most prevalent segment of our data.

```{r}
#Histogram of Number of Beds
ggplot(listings_data, aes(x= minimum_nights))+
  geom_histogram(binwidth = 1, fill= "skyblue", color= "black") +
  labs(title= "Distribution of Minimum Nights", x= "Minimum Nights", y= "Number of Listings") +
  theme_minimal()
```

We find that the optimal minimum night for price category of luxury and premium is 4 (in terms of maximising revenue). For Mid-Range, it is 5 and for budget, it is 3. 

```{r}
#Filter the data for 1-7 Minimum Nights
filered_min_night_data <- listings_data %>% filter(minimum_nights <= 7)

#Group by Price Category and Minimum Nights and calculate weighted average
optimal_nights_data <- filered_min_night_data %>%
  group_by(price_category, minimum_nights) %>%
  summarise(weighted_avg_revenue= sum(price* booking_frequency)/ n())

#Plotting Weighted Average Revenue for each Minimum Night by Price Category
ggplot(optimal_nights_data, aes(x= as.factor(minimum_nights), y= weighted_avg_revenue, color= price_category, group= price_category)) +
  geom_line(size=1) +
  geom_point(size=3) +
  labs(title= "Weighted Average Revenue by Minimum Nights and Price Category", x= "Minimum Nights", y= "Weighted Average Revenue ($)", color= "Price Category")+
  theme_minimal() +
  theme(axis.text.x = element_text(angle= 45, hjust = 1))
```











